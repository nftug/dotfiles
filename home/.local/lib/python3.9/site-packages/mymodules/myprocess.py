# -*- coding: utf-8 -*-

import os
import subprocess
import time
import psutil


class MyProcess:
    def __init__(self, pattern, exact=True):
        self.pattern = pattern
        self.exact = exact

    def getpid(self, wait=False):
        while True:
            try:
                out = subprocess.check_output(
                    ['pgrep', '-u', str(os.getuid()),
                     '-x' if self.exact else None, self.pattern])
            except subprocess.CalledProcessError:
                self.pid_list = []
            else:
                self.pid_list = [int(_)
                                 for _ in out.decode().strip().split('\n')]

            if wait and len(self.getpid(wait=False)) == 0:
                time.sleep(1)
            else:
                break

        return self.pid_list

    def kill(self, wait=True):
        while len(self.getpid(wait=False)) > 0:
            for pid in self.pid_list:
                psutil.Process(pid).kill()
            if wait and len(self.getpid(wait=False)) > 0:
                time.sleep(1)
            else:
                break

        del self
